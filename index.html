<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Base Blasters ‚Äî Number Systems Arcade (Classic Only)</title>
<style>
  :root{
    --bg:#0b1020; --panel:#0e1530; --border:#26324d; --text:#eef4ff;
    --accent:#58a6ff; --good:#2ea043; --bad:#ef4444; --warn:#f59e0b; --muted:#a9b4c9;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    background:radial-gradient(1200px 800px at 20% -10%, #132042, var(--bg) 60%);
    font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial
  }
  header{
    display:flex; gap:.75rem; align-items:center; flex-wrap:wrap;
    padding:10px 14px; background:linear-gradient(180deg,#0d1734,#0a1227);
    border-bottom:1px solid var(--border); color:var(--text);
    position:sticky; top:0; z-index:5;
  }
  header .title{font-weight:700; letter-spacing:.5px}
  button{
    background:#0e1a3a; color:var(--text);
    border:1px solid var(--border); border-radius:10px; padding:8px 10px; cursor:pointer
  }
  .pill{padding:.35rem .6rem; border:1px solid var(--border); border-radius:999px;
        background:#0b1431; color:var(--muted);}
  /* Layout with sidebar */
  #wrap{padding:14px}
  .layout{display:grid; grid-template-columns:minmax(640px,1fr) 320px; gap:14px; align-items:start;}
  @media (max-width: 1100px){ .layout{grid-template-columns:1fr} #sidebar{order:2} canvas{order:1} }
  #sidebar{
    background:linear-gradient(180deg,#0a1227,#0b1431);
    border:1px solid var(--border); border-radius:14px; color:var(--text);
    padding:12px; box-shadow:0 8px 20px rgba(0,0,0,.25)
  }
  #sidebar h3{margin:4px 0 8px; font-size:18px; letter-spacing:.3px}
  #sidebar .mini{color:var(--muted); font-size:12px; margin:-2px 0 10px}
  .hint{font-size:14px; line-height:1.35}
  .badge{display:inline-block; padding:2px 6px; border:1px solid var(--border); border-radius:8px;
         background:#0b1431; font-family:Consolas,Menlo,monospace}
  table.cheat{width:100%; border-collapse:collapse; font-family:Consolas,Menlo,monospace; font-size:13px}
  table.cheat td, table.cheat th{border:1px solid #23324d; padding:4px 6px; text-align:center}
  table.cheat th{background:#0f1836}

  canvas{
    background:linear-gradient(#020611,#091229);
    border:1px solid var(--border); border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.35);
    image-rendering:pixelated
  }
  footer{color:#93a3c6; text-align:center; padding:10px 0 20px}
</style>
</head>
<body>
  <header>
    <div class="title">üöÄ <span>Base Blasters</span></div>
    <button id="start">Start</button>
    <button id="pause">Pause</button>
    <button id="restart">Restart</button>
    <span class="pill">Controls: ‚Üê ‚Üí move, Space shoot, P pause, R restart, H help</span>
  </header>

  <div id="wrap" class="layout">
    <canvas id="game" width="960" height="600" aria-label="Base Blasters Game Canvas"></canvas>
    <aside id="sidebar" aria-live="polite">
      <h3>üß† In-Game Hints</h3>
      <div class="mini">Quick mental methods for this round</div>
      <div id="hintTitle" class="badge">Ready</div>
      <div id="hintBody" class="hint" style="margin:8px 0 10px">
        Press <strong>Start</strong>. Hints adapt to each question.
      </div>
      <div id="cheat"></div>
    </aside>
  </div>

  <footer>¬© Prototype for classroom use. No external libs. </footer>

<script>
(() => {
  // ---------- Canvas ----------
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const W = canvas.width, H = canvas.height;

  // ---------- UI ----------
  const $start = document.getElementById('start');
  const $pause = document.getElementById('pause');
  const $restart = document.getElementById('restart');

  // Sidebar DOM
  const $hintTitle = document.getElementById('hintTitle');
  const $hintBody  = document.getElementById('hintBody');
  const $cheat     = document.getElementById('cheat');

  // ---------- State ----------
  let state = 'menu'; // menu | playing | paused | gameover
  let last = 0, dt = 0;
  const keys = { left:false, right:false, shoot:false };

  const player = { x: W/2, y: H-64, w: 56, h: 24, speed: 360, cooldown:0, cooldownMax:0.25 };
  let bullets = []; // {x,y,w,h,vy}
  let aliens  = []; // {x,y,w,h,vy,text,correct,base}

  let score = 0, lives = 3, level = 1, streak = 0, target = 0;
  let baseTarget = 2; // 2, 8, 12, 16
  let roundText = '';
  let messageFlash = 0;

  // ---------- Utils ----------
  const clamp = (v, lo, hi) => Math.max(lo, Math.min(hi, v));
  const randInt = (min, max) => Math.floor(Math.random()*(max-min+1))+min;

  function toBase(n, base){
    if (base < 2 || base > 16) throw new Error('Base out of range');
    if (n === 0) return '0';
    const digits = '0123456789ABCDEF';
    let s = '', x = Math.floor(Math.abs(n));
    while (x > 0) { const d = x % base; s = digits[d] + s; x = Math.floor(x / base); }
    return s;
  }
  function toBaseDuodecimal(n){
    if (n === 0) return '0';
    const digits='0123456789AB';
    let s='', x=Math.floor(Math.abs(n));
    while(x>0){ const d=x%12; s=digits[d]+s; x=Math.floor(x/12); }
    return s;
  }

  function resetGame(){
    state='menu'; score=0; lives=3; level=1; streak=0; messageFlash=0;
    bullets.length=0; aliens.length=0; target=0; roundText='';
  }
  function startGame(){ state='playing'; score=0; lives=3; level=1; streak=0; bullets.length=0; aliens.length=0; newRound(); }
  function gameOver(){ state='gameover'; }
  function nextLevel(){ level++; newRound(); }

  function classicRange(){ if (level<4) return {min:0,max:63}; if(level<7) return {min:0,max:255}; return {min:0,max:4095}; }
  function pickBase(){ const bases=[2,8,12,16]; return bases[(level + Math.floor(Math.random()*10)) % bases.length]; }
  function labelForBase(b){ return b===2?'BINARY':b===8?'OCTAL':b===12?'DUODECIMAL':'HEX'; }
  function convertForBase(n,b){ return b===12?toBaseDuodecimal(n):toBase(n,b); }
  function waveSpeed(){ return 40 + level*6; }

  // ---------- Round ----------
  function newRound(){
    bullets.length=0; aliens.length=0; messageFlash=0;

    const {min,max} = classicRange();
    target = randInt(min,max);
    baseTarget = pickBase();

    const correct = convertForBase(target, baseTarget);
    const decoys  = makeDecoys(correct, 5, baseTarget);

    roundText = `Convert ${target} to ${labelForBase(baseTarget)}`;
    spawnAliens([correct, ...decoys], baseTarget);
    updateHints();
  }

  function makeDecoys(correctText, count, base){
    const decoys = new Set();
    const chars = (base===12) ? '0123456789AB' : '0123456789ABCDEF'.slice(0, base);
    const L = correctText.length;
    let safety=0;
    while (decoys.size < count && safety < 200){
      safety++;
      let arr = correctText.split('');
      const changes = Math.random()<0.6 ? 1 : 2;
      for(let i=0;i<changes;i++){
        const pos = randInt(0, L-1);
        let c; do { c = chars[randInt(0, chars.length-1)]; } while (c === arr[pos]);
        arr[pos] = c;
      }
      const s = arr.join('');
      if (s !== correctText) decoys.add(s);
    }
    return [...decoys];
  }

  function measureAlien(text){
    ctx.save();
    ctx.font = '20px Consolas, Menlo, Monaco, monospace';
    const w = ctx.measureText(text).width + 24; // padding
    ctx.restore();
    return { w: Math.max(60, w), h: 36 };
  }

  function spawnAliens(options, base){
    // shuffle
    for (let i=options.length-1;i>0;i--){
      const j = (Math.random()*(i+1))|0; [options[i], options[j]] = [options[j], options[i]];
    }
    const cols = options.length;
    const leftPad = 50, rightPad = 50;
    const usableW = W - leftPad - rightPad;
    const colW = usableW / cols;

    aliens.length = 0;
    const correctText = convertForBase(target, baseTarget);

    options.forEach((text, i) => {
      const {w,h} = measureAlien(text);
      const cx = leftPad + colW*i + colW/2;
      const x = cx - w/2;
      const y = -randInt(60, 200) - i*20; // slight stagger
      aliens.push({ x, y, w, h, vy: waveSpeed(), text, correct: text===correctText, base });
    });
  }

  // ---------- Hints Sidebar ----------
  function cheatTable(rows){
    if (!rows || !rows.length) return '';
    const thead = '<tr>' + Object.keys(rows[0]).map(k=>`<th>${k}</th>`).join('') + '</tr>';
    const body  = rows.map(r=>'<tr>'+Object.values(r).map(v=>`<td>${v}</td>`).join('')+'</tr>').join('');
    return `<table class="cheat">${thead}${body}</table>`;
  }

  function updateHints(){
    const label = labelForBase(baseTarget);
    $hintTitle.textContent = label;

    if (baseTarget === 2){
      $hintBody.innerHTML = `Think in powers of 2. Subtract the biggest you can from <b>${target}</b> (128,64,32,16,8,4,2,1). 1 = used, 0 = not used.`;
      const map = [
        {Power:'128',Bit:'?'},{Power:'64',Bit:'?'},{Power:'32',Bit:'?'},{Power:'16',Bit:'?'},
        {Power:'8',Bit:'?'},{Power:'4',Bit:'?'},{Power:'2',Bit:'?'},{Power:'1',Bit:'?'}
      ];
      $cheat.innerHTML = cheatTable(map) + `<div class="mini">Alt: divide by 2 repeatedly, record remainders, then read them <i>backwards</i>.</div>`;
    }
    else if (baseTarget === 8){
      $hintBody.innerHTML = `Quick way: convert to binary then group in 3s from the right ‚Üí each group becomes 0‚Äì7.`;
      $cheat.innerHTML = cheatTable([
        {Oct:'0', Bin:'000'}, {Oct:'1', Bin:'001'}, {Oct:'2', Bin:'010'}, {Oct:'3', Bin:'011'},
        {Oct:'4', Bin:'100'}, {Oct:'5', Bin:'101'}, {Oct:'6', Bin:'110'}, {Oct:'7', Bin:'111'}
      ]) + `<div class="mini">Or repeatedly divide by 8 and read remainders backwards.</div>`;
    }
    else if (baseTarget === 12){
      $hintBody.innerHTML = `Divide ${target} by 12. Remainders 10‚Üí<b>A</b>, 11‚Üí<b>B</b>. Think in dozens (12s).`;
      $cheat.innerHTML = cheatTable([
        {Power:'12^0', Value:1}, {Power:'12^1', Value:12}, {Power:'12^2', Value:144}, {Power:'12^3', Value:1728}
      ]) + `<div class="mini">Mental: n = q√ó12 + r ‚Üí digit=r (A/B if 10/11).</div>`;
    }
    else if (baseTarget === 16){
      $hintBody.innerHTML = `Fastest: binary ‚Üí group in 4s (nibble). Or repeated √∑16. A=10‚Ä¶F=15.`;
      const map = [
        {Hex:'0', Bin:'0000'}, {Hex:'1', Bin:'0001'}, {Hex:'2', Bin:'0010'}, {Hex:'3', Bin:'0011'},
        {Hex:'4', Bin:'0100'}, {Hex:'5', Bin:'0101'}, {Hex:'6', Bin:'0110'}, {Hex:'7', Bin:'0111'},
        {Hex:'8', Bin:'1000'}, {Hex:'9', Bin:'1001'}, {Hex:'A', Bin:'1010'}, {Hex:'B', Bin:'1011'},
        {Hex:'C', Bin:'1100'}, {Hex:'D', Bin:'1101'}, {Hex:'E', Bin:'1110'}, {Hex:'F', Bin:'1111'}
      ];
      $cheat.innerHTML = cheatTable(map);
    }
  }

  // ---------- Input ----------
  function shoot(){
    if (player.cooldown > 0) return;
    player.cooldown = player.cooldownMax;
    bullets.push({ x: player.x - 2, y: player.y - 18, w: 4, h: 14, vy: -520 });
  }

  window.addEventListener('keydown', (e) => {
    if (e.repeat) return;
    if (e.key === 'ArrowLeft' || e.key === 'a') keys.left  = true;
    if (e.key === 'ArrowRight'|| e.key === 'd') keys.right = true;
    if (e.key === ' '){ keys.shoot = true; shoot(); }
    if (e.key.toLowerCase() === 'p') togglePause();
    if (e.key.toLowerCase() === 'r') { resetGame(); startGame(); }
    if (e.key.toLowerCase() === 'h') helpFlash = 2.5;
  });
  window.addEventListener('keyup', (e) => {
    if (e.key === 'ArrowLeft' || e.key === 'a') keys.left  = false;
    if (e.key === 'ArrowRight'|| e.key === 'd') keys.right = false;
    if (e.key === ' ') keys.shoot = false;
  });

  $start.addEventListener('click', () => { if (state!=='playing'){ resetGame(); startGame(); } });
  $pause.addEventListener('click', togglePause);
  $restart.addEventListener('click', () => { resetGame(); startGame(); });

  function togglePause(){ state = (state==='playing') ? 'paused' : (state==='paused' ? 'playing' : state); }

  // ---------- Update / Physics ----------
  function update(dt){
    if (state !== 'playing') return;

    // Player
    let vx = 0;
    if (keys.left)  vx -= player.speed;
    if (keys.right) vx += player.speed;
    player.x = clamp(player.x + vx*dt, player.w/2 + 10, W - player.w/2 - 10);
    if (player.cooldown > 0){ player.cooldown -= dt; if (player.cooldown < 0) player.cooldown = 0; }

    // Bullets
    for (let i=bullets.length-1;i>=0;i--){
      const b = bullets[i]; b.y += b.vy * dt;
      if (b.y + b.h < 0) bullets.splice(i,1);
    }

    // Aliens
    let reachedBottom = false;
    aliens.forEach(a => { a.y += a.vy * dt; if (a.y + a.h >= H-80) reachedBottom = true; });

    // Collisions
    for (let i=aliens.length-1;i>=0;i--){
      const a = aliens[i];
      for (let j=bullets.length-1;j>=0;j--){
        const b = bullets[j];
        if (rectsOverlap(a,b)){
          bullets.splice(j,1);
          const wasCorrect = a.correct;
          aliens.splice(i,1);
          if (wasCorrect){
            const bonus = 100 + Math.floor(level*10) + streak*10;
            score += bonus; streak++; messageFlash = 0.6;
            aliens.length = 0; setTimeout(() => nextLevel(), 150);
          } else {
            lives--; streak = 0; screenShake(8); messageFlash = 0.0;
            if (lives <= 0) gameOver();
          }
          break;
        }
      }
    }

    if (reachedBottom){
      lives--; streak = 0; aliens.length = 0; screenShake(10);
      if (lives <= 0) gameOver(); else setTimeout(() => newRound(), 250);
    }
  }

  function rectsOverlap(a,b){
    return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;
  }

  // ---------- Effects ----------
  let shakeTime=0, shakeMag=0;
  function screenShake(mag){ shakeTime = 0.25; shakeMag = mag; }
  function applyShake(){
    if (shakeTime <= 0) return {x:0,y:0};
    shakeTime -= dt; if (shakeTime < 0) shakeTime = 0;
    const t = Math.random()*Math.PI*2;
    const m = shakeMag * (shakeTime/0.25);
    return { x: Math.cos(t)*m, y: Math.sin(t)*m };
  }

  // ---------- Render ----------
  let helpFlash = 2.5;
  function draw(){
    ctx.clearRect(0,0,W,H);
    drawStars();

    ctx.save();
    const sh = applyShake();
    ctx.translate(sh.x, sh.y);

    // HUD
    ctx.fillStyle = '#0a1330';
    ctx.fillRect(0,0,W,64);
    ctx.strokeStyle = 'rgba(255,255,255,0.06)';
    ctx.strokeRect(0.5,0.5,W-1,64);

    ctx.fillStyle = '#9fb4ff';
    ctx.font = '20px Consolas,Monaco,monospace';
    ctx.fillText(`Score: ${score}`, 16, 28);
    ctx.fillText(`Lives: ${'‚ù§'.repeat(lives)}`, 16, 52);
    ctx.fillText(`Level ${level}`, W-150, 28);
    ctx.fillText('CLASSIC', W-150, 52);

    // Round text
    ctx.fillStyle = '#e9eeff';
    ctx.font = '24px Consolas,Monaco,monospace';
    const tw = ctx.measureText(roundText).width;
    ctx.fillText(roundText, (W-tw)/2, 40);

    // Player + bullets + aliens
    drawShip(player.x, player.y);
    ctx.fillStyle = '#c8e1ff';
    bullets.forEach(b => ctx.fillRect(b.x, b.y, b.w, b.h));
    aliens.forEach(a => drawAlien(a));

    // Feedback
    if (messageFlash > 0){
      messageFlash -= dt;
      ctx.save();
      ctx.globalAlpha = Math.max(0, messageFlash);
      ctx.fillStyle = '#b7ffbf';
      ctx.font = '28px Consolas,Monaco,monospace';
      const msg='‚úî Correct!';
      const mW=ctx.measureText(msg).width;
      ctx.fillText(msg, (W-mW)/2, H*0.55);
      ctx.restore();
    }

    // States
    if (state==='menu')   drawCenterBox('Base Blasters','Press Start (or R) to begin');
    if (state==='paused') drawCenterBox('Paused','Press P to resume');
    if (state==='gameover') drawCenterBox('Game Over','Press Restart (or R)');

    // Quick hint
    if (helpFlash > 0){
      helpFlash -= dt;
      ctx.save(); ctx.globalAlpha = Math.min(0.9, helpFlash);
      ctx.fillStyle = '#d2dcff';
      ctx.font = '16px Consolas,Monaco,monospace';
      const hint = 'Hint: Binary=2, Octal=8, Duo=12 (A=10,B=11), Hex=16.';
      const w2 = ctx.measureText(hint).width;
      ctx.fillText(hint, (W-w2)/2, H-12);
      ctx.restore();
    }

    ctx.restore();
  }

  function drawCenterBox(title, subtitle){
    ctx.save();
    const boxW=520, boxH=150;
    const x=(W-boxW)/2, y=(H-boxH)/2;
    ctx.fillStyle='rgba(8, 14, 40, 0.92)';
    ctx.strokeStyle='rgba(255,255,255,0.08)';
    ctx.lineWidth=2;
    roundRect(ctx, x, y, boxW, boxH, 16, true, true);
    ctx.fillStyle='#eaf0ff';
    ctx.font='32px Consolas,Monaco,monospace';
    const tw=ctx.measureText(title).width;
    ctx.fillText(title, x+(boxW-tw)/2, y+54);
    ctx.fillStyle='#a9b4c9';
    ctx.font='18px Consolas,Monaco,monospace';
    const sw=ctx.measureText(subtitle).width;
    ctx.fillText(subtitle, x+(boxW-sw)/2, y+94);
    ctx.restore();
  }

  function drawShip(cx, cy){
    ctx.save();
    ctx.translate(cx, cy);
    ctx.fillStyle = '#7cbcff';
    roundRect(ctx, -player.w/2, -player.h/2, player.w, player.h, 6, true, false);
    ctx.fillStyle = '#c7e3ff';
    roundRect(ctx, -12, -player.h/2 - 6, 24, 14, 6, true, false);
    ctx.fillStyle = '#93caff';
    ctx.fillRect(-player.w/2 - 10, -6, 10, 8);
    ctx.fillRect(player.w/2, -6, 10, 8);
    ctx.restore();
  }

  function drawAlien(a){
    ctx.save();
    const baseColor = (a.base===2? '#8ef1b9' : a.base===8? '#f9d66c' : a.base===12? '#c8a3ff' : '#ff9dcf');
    ctx.fillStyle = baseColor;
    ctx.globalAlpha = 0.15;
    roundRect(ctx, a.x, a.y, a.w, a.h, 8, true, false);
    ctx.globalAlpha = 1;
    ctx.strokeStyle = baseColor;
    ctx.lineWidth = 2;
    roundRect(ctx, a.x, a.y, a.w, a.h, 8, false, true);

    // antenna
    ctx.beginPath();
    ctx.moveTo(a.x + a.w/2, a.y);
    ctx.lineTo(a.x + a.w/2, a.y - 10);
    ctx.stroke();
    ctx.beginPath();
    ctx.arc(a.x + a.w/2, a.y - 12, 3, 0, Math.PI*2);
    ctx.fillStyle = baseColor; ctx.fill();

    // label
    ctx.fillStyle = '#eaf0ff';
    ctx.font = '20px Consolas,Monaco,monospace';
    const textW = ctx.measureText(a.text).width;
    ctx.fillText(a.text, a.x + (a.w - textW)/2, a.y + 24);
    ctx.restore();
  }

  function drawStars(){
    const t = performance.now()/1000;
    for (let i=0;i<120;i++){
      const x = (i*53 % W);
      const y = ((i*97 + Math.floor(t*30)) % H);
      ctx.fillStyle = i%9===0 ? '#cfe2ff' : '#9ab6ff';
      ctx.fillRect(x, y, 2, 2);
    }
  }

  function roundRect(ctx, x, y, w, h, r, fill, stroke){
    if (w < 2*r) r = w/2;
    if (h < 2*r) r = h/2;
    ctx.beginPath();
    ctx.moveTo(x+r, y);
    ctx.arcTo(x+w, y, x+w, y+h, r);
    ctx.arcTo(x+w, y+h, x, y+h, r);
    ctx.arcTo(x, y+h, x, y, r);
    ctx.arcTo(x, y, x+w, y, r);
    ctx.closePath();
    if (fill) ctx.fill();
    if (stroke) ctx.stroke();
  }

  // ---------- Main Loop ----------
  function loop(ts){
    dt = (ts - last)/1000; if (dt > 0.05) dt = 0.05; last = ts;
    update(dt);
    draw();
    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);

  // ---------- Init ----------
  resetGame();
  updateHints();
})();
</script>
</body>
</html>
